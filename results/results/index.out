-- Test tapir index access method functionality
-- Load tapir extension
CREATE EXTENSION IF NOT EXISTS tapir;
-- Enable score logging for testing
SET tapir.log_scores = true;
-- Setup test table
CREATE TABLE test_docs (
    id SERIAL PRIMARY KEY,
    content TEXT
);
INSERT INTO test_docs (content) VALUES
    ('the quick brown fox'),
    ('jumped over the lazy dog'),
    ('sphinx of black quartz'),
    ('hello world example'),
    ('postgresql full text search');
-- Test index creation with different text_config options
CREATE INDEX docs_english_idx ON test_docs USING tapir(content) WITH (text_config='english');
NOTICE:  Tapir index build started for relation docs_english_idx
NOTICE:  Using text search configuration: english
NOTICE:  Using index options: k1=1.20, b=0.75
NOTICE:  Tapir index build completed: 5 documents, avg_length=3.20, text_config='english' (k1=1.20, b=0.75)
CREATE INDEX docs_simple_idx ON test_docs USING tapir(content) WITH (text_config='simple', k1=1.5, b=0.8);
NOTICE:  Tapir index build started for relation docs_simple_idx
NOTICE:  Using text search configuration: simple
NOTICE:  Using index options: k1=1.50, b=0.80
NOTICE:  Tapir index build completed: 5 documents, avg_length=4.00, text_config='simple' (k1=1.50, b=0.80)
-- Verify indexes were created
\d+ test_docs
                                                 Table "public.test_docs"
 Column  |  Type   | Collation | Nullable |                Default                | Storage  | Stats target | Description
---------+---------+-----------+----------+---------------------------------------+----------+--------------+-------------
 id      | integer |           | not null | nextval('test_docs_id_seq'::regclass) | plain    |              |
 content | text    |           |          |                                       | extended |              |
Indexes:
    "test_docs_pkey" PRIMARY KEY, btree (id)
    "docs_english_idx" tapir (content) WITH (text_config=english)
    "docs_simple_idx" tapir (content) WITH (text_config=simple, k1='1.5', b='0.8')

-- Test basic index operations
INSERT INTO test_docs (content) VALUES ('new document for testing');
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
connection to server was lost
