CREATE EXTENSION IF NOT EXISTS pg_textsearch;
CREATE EXTENSION
SET pg_textsearch.log_scores = true;
SET
SET enable_seqscan = off;
SET
CREATE TABLE scoring1_bulk (
    id SERIAL PRIMARY KEY,
    content TEXT
);
CREATE TABLE
INSERT INTO scoring1_bulk (content) VALUES ('hello world');
INSERT 0 1
INSERT INTO scoring1_bulk (content) VALUES ('goodbye cruel world');
INSERT 0 1
CREATE INDEX scoring1_bulk_idx ON scoring1_bulk USING bm25(content)
  WITH (text_config='english', k1=1.2, b=0.75);
CREATE INDEX
SELECT id, content, ROUND((content <@> to_bm25query('hello', 'scoring1_bulk_idx'))::numeric, 4) as score
FROM scoring1_bulk
ORDER BY content <@> to_bm25query('hello', 'scoring1_bulk_idx'), id;
 id |       content       |  score  
----+---------------------+---------
  1 | hello world         | -0.7549
  2 | goodbye cruel world |  0.0000
(2 rows)

SELECT id, content, ROUND((content <@> to_bm25query('cruel', 'scoring1_bulk_idx'))::numeric, 4) as score
FROM scoring1_bulk
ORDER BY content <@> to_bm25query('cruel', 'scoring1_bulk_idx'), id;
 id |       content       |  score  
----+---------------------+---------
  2 | goodbye cruel world | -0.6407
  1 | hello world         |  0.0000
(2 rows)

CREATE TABLE scoring1_incr (
    id SERIAL PRIMARY KEY,
    content TEXT
);
CREATE TABLE
CREATE INDEX scoring1_incr_idx ON scoring1_incr USING bm25(content)
  WITH (text_config='english', k1=1.2, b=0.75);
CREATE INDEX
INSERT INTO scoring1_incr (content) VALUES ('hello world');
INSERT 0 1
INSERT INTO scoring1_incr (content) VALUES ('goodbye cruel world');
INSERT 0 1
SELECT id, content, ROUND((content <@> to_bm25query('hello', 'scoring1_incr_idx'))::numeric, 4) as score
FROM scoring1_incr
ORDER BY content <@> to_bm25query('hello', 'scoring1_incr_idx'), id;
 id |       content       |  score  
----+---------------------+---------
  1 | hello world         | -0.7549
  2 | goodbye cruel world |  0.0000
(2 rows)

SELECT id, content, ROUND((content <@> to_bm25query('cruel', 'scoring1_incr_idx'))::numeric, 4) as score
FROM scoring1_incr
ORDER BY content <@> to_bm25query('cruel', 'scoring1_incr_idx'), id;
 id |       content       |  score  
----+---------------------+---------
  2 | goodbye cruel world | -0.6407
  1 | hello world         |  0.0000
(2 rows)

DROP TABLE scoring1_bulk CASCADE;
DROP TABLE
DROP TABLE scoring1_incr CASCADE;
DROP TABLE
DROP EXTENSION pg_textsearch CASCADE;
DROP EXTENSION
