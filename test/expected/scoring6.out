-- Test case: scoring6
-- Generated BM25 test with 2 documents and 3 queries
-- Testing both bulk build and incremental build modes
CREATE EXTENSION IF NOT EXISTS pgtextsearch;
INFO:  pgtextsearch v0.0.1: This is prerelease software and should not be used in production.
SET pgtextsearch.log_scores = true;
SET enable_seqscan = off;
-- MODE 1: Bulk build (insert data, then create index)
CREATE TABLE scoring6_bulk (
    id SERIAL PRIMARY KEY,
    content TEXT
);
-- Insert test documents
INSERT INTO scoring6_bulk (content) VALUES ('hello, world!');
INSERT INTO scoring6_bulk (content) VALUES ('goodbye cruel world...');
-- Create index after data insertion (bulk build)
CREATE INDEX scoring6_bulk_idx ON scoring6_bulk USING bm25(content)
  WITH (text_config='english', k1=1.2, b=0.75);
NOTICE:  Tapir index build started for relation scoring6_bulk_idx
NOTICE:  Using text search configuration: english
NOTICE:  Using index options: k1=1.20, b=0.75
ERROR:  too many dynamic shared memory segments
-- Bulk mode query 1: 'hello'
SELECT id, content, ROUND((content <@> to_bm25query('hello', 'scoring6_bulk_idx'))::numeric, 4) as score
FROM scoring6_bulk
ORDER BY content <@> to_bm25query('hello', 'scoring6_bulk_idx'), id;
ERROR:  index "scoring6_bulk_idx" not found
-- Bulk mode query 2: 'goodbye'
SELECT id, content, ROUND((content <@> to_bm25query('goodbye', 'scoring6_bulk_idx'))::numeric, 4) as score
FROM scoring6_bulk
ORDER BY content <@> to_bm25query('goodbye', 'scoring6_bulk_idx'), id;
ERROR:  index "scoring6_bulk_idx" not found
-- Bulk mode query 3: 'world'
SELECT id, content, ROUND((content <@> to_bm25query('world', 'scoring6_bulk_idx'))::numeric, 4) as score
FROM scoring6_bulk
ORDER BY content <@> to_bm25query('world', 'scoring6_bulk_idx'), id;
ERROR:  index "scoring6_bulk_idx" not found
-- MODE 2: Incremental build (create index, then insert data)
CREATE TABLE scoring6_incr (
    id SERIAL PRIMARY KEY,
    content TEXT
);
-- Create index before data insertion (incremental build)
CREATE INDEX scoring6_incr_idx ON scoring6_incr USING bm25(content)
  WITH (text_config='english', k1=1.2, b=0.75);
NOTICE:  Tapir index build started for relation scoring6_incr_idx
NOTICE:  Using text search configuration: english
NOTICE:  Using index options: k1=1.20, b=0.75
ERROR:  too many dynamic shared memory segments
-- Insert test documents incrementally
INSERT INTO scoring6_incr (content) VALUES ('hello, world!');
INSERT INTO scoring6_incr (content) VALUES ('goodbye cruel world...');
-- Incremental mode query 1: 'hello'
SELECT id, content, ROUND((content <@> to_bm25query('hello', 'scoring6_incr_idx'))::numeric, 4) as score
FROM scoring6_incr
ORDER BY content <@> to_bm25query('hello', 'scoring6_incr_idx'), id;
ERROR:  index "scoring6_incr_idx" not found
-- Incremental mode query 2: 'goodbye'
SELECT id, content, ROUND((content <@> to_bm25query('goodbye', 'scoring6_incr_idx'))::numeric, 4) as score
FROM scoring6_incr
ORDER BY content <@> to_bm25query('goodbye', 'scoring6_incr_idx'), id;
ERROR:  index "scoring6_incr_idx" not found
-- Incremental mode query 3: 'world'
SELECT id, content, ROUND((content <@> to_bm25query('world', 'scoring6_incr_idx'))::numeric, 4) as score
FROM scoring6_incr
ORDER BY content <@> to_bm25query('world', 'scoring6_incr_idx'), id;
ERROR:  index "scoring6_incr_idx" not found
-- Cleanup
DROP TABLE scoring6_bulk CASCADE;
ERROR:  too many dynamic shared memory segments
DROP TABLE scoring6_incr CASCADE;
ERROR:  too many dynamic shared memory segments
DROP EXTENSION pgtextsearch CASCADE;
