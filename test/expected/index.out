-- Test pg_textsearch index access method functionality
-- Load pg_textsearch extension
CREATE EXTENSION IF NOT EXISTS pg_textsearch;
INFO:  pg_textsearch v0.5.0 installed
-- Enable score logging for testing
SET pg_textsearch.log_scores = true;
-- Setup test table
CREATE TABLE test_docs (
    id SERIAL PRIMARY KEY,
    content TEXT
);
INSERT INTO test_docs (content) VALUES
    ('the quick brown fox'),
    ('jumped over the lazy dog'),
    ('sphinx of black quartz'),
    ('hello world example'),
    ('postgresql full text search');
-- Test index creation with different text_config options
CREATE INDEX docs_english_idx ON test_docs USING bm25(content) WITH (text_config='english');
NOTICE:  BM25 index build started for relation docs_english_idx
NOTICE:  Using text search configuration: english
NOTICE:  Using index options: k1=1.20, b=0.75
NOTICE:  BM25 index build completed: 5 documents, avg_length=3.20, text_config='english' (k1=1.20, b=0.75)
CREATE INDEX docs_simple_idx ON test_docs USING bm25(content) WITH (text_config='simple', k1=1.5, b=0.8);
NOTICE:  BM25 index build started for relation docs_simple_idx
NOTICE:  Using text search configuration: simple
NOTICE:  Using index options: k1=1.50, b=0.80
NOTICE:  BM25 index build completed: 5 documents, avg_length=4.00, text_config='simple' (k1=1.50, b=0.80)
-- Verify indexes were created
\d+ test_docs
                                                 Table "public.test_docs"
 Column  |  Type   | Collation | Nullable |                Default                | Storage  | Stats target | Description 
---------+---------+-----------+----------+---------------------------------------+----------+--------------+-------------
 id      | integer |           | not null | nextval('test_docs_id_seq'::regclass) | plain    |              | 
 content | text    |           |          |                                       | extended |              | 
Indexes:
    "test_docs_pkey" PRIMARY KEY, btree (id)
    "docs_english_idx" bm25 (content) WITH (text_config=english)
    "docs_simple_idx" bm25 (content) WITH (text_config=simple, k1='1.5', b='0.8')
Not-null constraints:
    "test_docs_id_not_null" NOT NULL "id"

-- Test basic index operations
INSERT INTO test_docs (content) VALUES ('new document for testing');
-- Test that index options are correctly stored and retrievable
SELECT
    i.relname as index_name,
    CASE
        WHEN i.reloptions IS NOT NULL THEN 'has_options'
        ELSE 'no_options'
    END as options_status
FROM pg_class i
WHERE i.relname IN ('docs_english_idx', 'docs_simple_idx')
ORDER BY i.relname;
    index_name    | options_status 
------------------+----------------
 docs_english_idx | has_options
 docs_simple_idx  | has_options
(2 rows)

-- Cleanup
DROP INDEX docs_english_idx;
DROP INDEX docs_simple_idx;
DROP TABLE test_docs;
DROP EXTENSION pg_textsearch CASCADE;
